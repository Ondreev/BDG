<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ò–í–ò BDG ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–∫—É–ø–æ–∫</title>
    <link rel="icon" type="image/png" href="https://cdn.abacus.ai/images/9def1789-3a84-47d1-8403-586336c53bdd.png">
    <style>
        body {
            background: #ff3ebf;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0 12px;
        }
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å */
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —à–∞–ø–∫–∞ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->

    <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º unit -->
    <div id="itemModal" class="modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);z-index:1000;">
        <div class="modal-content" style="background:#fff;padding:24px;border-radius:12px;max-width:400px;margin:80px auto;position:relative;">
            <div class="modal-header" style="font-size:1.2rem;font-weight:bold;margin-bottom:15px;">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
            <div class="form-group" style="margin-bottom:15px; position: relative;">
                <label for="itemName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:</label>
                <input type="text" id="itemName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –•–ª–µ–±" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:1rem;" oninput="showAutocomplete()">
                <ul id="autocompleteList" class="autocomplete-list" style="display: none;"></ul>
            </div>
            <div class="form-group" style="margin-bottom:15px;">
                <label for="itemQuantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                <input type="number" id="itemQuantity" placeholder="1" min="1" value="1" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:1rem;">
            </div>
            <div class="form-group" style="margin-bottom:15px;">
                <label for="itemUnit">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è:</label>
                <select id="itemUnit" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:1rem;">
                    <option value="—à—Ç">—à—Ç</option>
                    <option value="–∫–≥">–∫–≥</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom:15px;">
                <label for="itemPrice">–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (—Ä—É–±):</label>
                <input type="number" id="itemPrice" placeholder="50" min="0" step="0.01" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:1rem;">
            </div>
            <div class="modal-buttons" style="display:flex;gap:10px;justify-content:flex-end;">
                <button class="btn btn-secondary" onclick="closeItemModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="addItem()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        function openAddItemModal(storeIndex) {
            currentStoreIndex = storeIndex;
            document.getElementById('itemName').value = '';
            document.getElementById('itemQuantity').value = '1';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemUnit').value = '—à—Ç';
            document.getElementById('autocompleteList').style.display = 'none';
            document.getElementById('autocompleteList').innerHTML = '';
            document.getElementById('itemModal').style.display = 'block';
        }

        function addItem() {
            const name = document.getElementById('itemName').value.trim();
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 1;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            const unit = document.getElementById('itemUnit').value || '—à—Ç';

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');
                return;
            }
            if (price <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É');
                return;
            }

            const newItem = {
                name: name,
                quantity: quantity,
                price: price,
                unit: unit,
                bought: false
            };

            appData.stores[currentStoreIndex].items.push(newItem);

            const existingItemIndex = appData.allItems.findIndex(item => 
                item.name.toLowerCase() === name.toLowerCase()
            );

            if (existingItemIndex !== -1) {
                appData.allItems[existingItemIndex] = {
                    name: name,
                    quantity: quantity,
                    price: price,
                    unit: unit
                };
            } else {
                appData.allItems.push({
                    name: name,
                    quantity: quantity,
                    price: price,
                    unit: unit
                });
            }

            saveData();
            renderApp();
            closeItemModal();
        }

        function renderStores() {
            const container = document.getElementById('storesList');
            container.innerHTML = '';
            appData.stores.forEach((store, storeIndex) => {
                const storeDiv = document.createElement('div');
                storeDiv.className = 'store';
                const subtotal = calculateStoreSubtotal(store);
                storeDiv.innerHTML = `
                    <div class="store-header">
                        <div class="store-name">üõí ${store.name}</div>
                        <div>
                            <button class="btn btn-secondary" onclick="toggleAllItems(${storeIndex})">–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å—ë</button>
                            <button class="delete-store-btn" onclick="deleteStore(${storeIndex})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                        <div class="store-subtotal">‚ÇΩ ${subtotal}</div>
                    </div>
                    <div class="items-list">
                        ${store.items.map((item, itemIndex) => `
                            <div class="item ${item.bought ? 'checked' : ''}">
                                <input type="checkbox" ${item.bought ? 'checked' : ''} onchange="toggleItem(${storeIndex}, ${itemIndex})">
                                <div class="item-details">
                                    <div class="item-name" onclick="editItemName(${storeIndex}, ${itemIndex})" style="cursor: pointer;">
                                        <span id="itemName-${storeIndex}-${itemIndex}">${item.name}</span>
                                    </div>
                                    <div class="item-calc">
                                        <span onclick="editItemQuantity(${storeIndex}, ${itemIndex})" style="cursor: pointer;">
                                            <span id="itemQuantity-${storeIndex}-${itemIndex}">${item.quantity}</span> 
                                            <span id="itemUnit-${storeIndex}-${itemIndex}">${item.unit || '—à—Ç'}</span>
                                        </span> x 
                                        <span onclick="editItemPrice(${storeIndex}, ${itemIndex})" style="cursor: pointer;">
                                            <span id="itemPrice-${storeIndex}-${itemIndex}">${item.price}</span> —Ä—É–±
                                        </span> = 
                                        <span class="item-total">\${(item.quantity * item.price).toFixed(2)} —Ä—É–±</span>
                                    </div>
                                </div>
                                <button class="item-delete" onclick="deleteItem(${storeIndex}, ${itemIndex})">√ó</button>
                            </div>
                        `).join('')}
                        <div class="item">
                            <button class="btn btn-secondary" onclick="openAddItemModal(${storeIndex})" style="width: 100%;">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                        </div>
                    </div>
                `;
                container.appendChild(storeDiv);
            });
        }
    </script>
</body>
</html>
